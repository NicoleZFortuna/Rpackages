# Building R Packages

This is a workshop which has been designed as a guided walkthrough for how to organise a series of functions into an R package. The building of functions themselves is outside of the scope of of this workshop. For a refresher on function construction you can visit the following: https://r4ds.had.co.nz/functions.html.

This workshop is meant as a guide to assist in the conversion of the functions contained in the MyFunctions.R file of this GitHub repository, into an R package.

## Initiating a new package
The easiest method of initiating a new package is to create an RStudio project. Either click on 'File' and then 'New Project', or ![The add project button](pics/ProjectButton.png){width=3%} in the top left corner of the RStudio window. A 'Create Project' window will pop up, and you should select 'New Directory' followed by 'R Package'. The following window will then open, allowing you to specify the name for your package as well as choose the directory in which the package will be stored. At this point, you can select if you would like to initiate this repository with git repository. If you already have git installed on your computer, I recommend that you check the 'Create a git repository' box before you select 'Create Project'.

<center>![](pics/ProjectPrompt.png){width=50%}</center>

In your project window, you will see that a number of files have been automatically generated. These are the basic file types that are required for an R package.

**Required files and folders**

| File/Folder | Purpose |
|-|---|
| R folder | This folder contains .R scripts. This is where you will store all of your functions. |
| man folder | This folder contains information that will be used to generate help files. The contents of this folder should always be auto generated. You should never modify these files by hand. |
| DESCRIPTION file | This file contains important metadata about your package, including authorship, licencing, and dependencies. | 
| NAMESPACE file | This file states whether each function is exported from this package to be used by others, or imported from another package to be used locally.|

**Useful files and folders**

| File/Folder | Purpose |
|-|---|
| .Rroj file | This is a file generated by RStudio which contains project option information. |
| .Rbuildignore file | This is a text file that can be used to specify any files that you want to ignore when building your R package. | 
| .gitignore file | This is a useful file if you are tracking your R package with git. It allows you to prefent particular files from being tracked. |

**Additional files and folders**

| File/Folder | Purpose |
|-|---|
| Data folder | This folder is where you will place any data that your package needs access to to function. This data can also be made directly available to users. |
| data_raw folder | This folder contains scripts that can be used to generate the data contained in the Data file. | 
| vignettes folder | This folder can hold any vignettes that you build to help others learn how to use your package. |

### Fill in the DESCRIPTION file

A DESCRIPTION file will have automatically generated for you, but you will still need to provide some information. The first thing we should do is specify the license, because it's annoying and we do not want to think about it ever again. To be clear, you do not need to specify a license for your package to work, so if you never intend to share your package with the outside world, feel free to omit a license.

For most of you, I recommend going with the GPL version 3 license. It allows people to use your code freely, but requires users to cite where they sourced the code from. This license will also require users to document how they have changed the code if they choose the share modifications.

For a simple guide to help choose the right license of you, click [here](https://choosealicense.com/). For a more in depth discussion on licensing, click [here](https://thinkr-open.github.io/licensing-r/whatis.html).

To easily add the recommended license you your package, run the following code:
```{r}
install.packages("usethis")
usethis::use_gpl_license()
```

This will update the DESCRIPTION file license, as well as generate LICENSE files in your package directory. You can now go ahead and provide the rest of the required information in the DESCRIPTION file.

### Add code to your package
Now it would be a good time to start adding functions to the package. Copy and paste the functions from the MyFunctions.R file in this repository into the auto generated hello.R file in your R/ folder.

This is probably a good place to make your first commit if you have initiated your project with a git repository (do not worry about this if you have not). Click here.... for instruction on this front.

Take a look at the contents of this file and note the different kinds of information contained in there.

#### Package data

The first thing that you will see is that this file contains a number of data.frames that are used to generate the output of one of the functions. This information should not be contained in the R folder as they are not themselves functions. Here we will need to generate two new folders. A data folder which will contain the built data objects, as well as a data_raw file which will contain scripts to generate the data contained in the data folder.

Run the following line to generate the data_raw folder and initiate a file for defining the `magicAnswers` object. 

```{r}
usethis::use_data_raw("magicAnswers")
```

Copy the code to generate the magicAnswers data.frame into the magicAnswers.R file which was opened within your RStudio. Make sure to not delete the `usethis::use_data(magicAnswers, overwrite = TRUE)` line when you do so. Run the magicAnswers.R script to generate the data folder as well as the magicAnswers.rda file within said folder.

You can now reuse the above code, replacing "magicAnswers", with "cookieAnswers", and then "tarotAnswers". Make sure to again copy the code used to generate these two data.frames into their respective data_raw files. Once you run these two scripts, their respective .rda files will be added to the data folder.

You can now delete the code for defining these three objects from the hello.R file.

Easy as.

Documentation for your package data.

#### Functions

Now we can start to organise the functions in a useful way. There is no set way to do this, so you should pick something that is going to be most useful for you. Some peope keep all their functions in the same file, others create a new file for each function in their package. Personally, I like to have a few files, each with their own theme. I will then organise the functions into each of these files according to what I think are useful groupings.

Open how ever many scripts as you like and add the relevant functions to each script. Give each script a relvant name, and save in the R folder of your package. 

The next step is to document your functions appropriately. This documentation will be used to generate the help files of your package.



### By hand

## Organising functions into files
### Functions
### Data

## Documenting functions

### Importing functions

### S3 functions

### Examples

### Generating NAMESPACE and help files

## Checking package

## Vignettes

## How to use git to track your package over time

### Publishing your package on GitHub




## Useful shortcuts

Install Package:           'Cmd + Shift + B'
Check Package:             'Cmd + Shift + E'
Test Package:              'Cmd + Shift + T'

## Useful resources

Licensing

For the absolute minimum required for a functioning R package, you can check out this blog by [Hilary Parker](https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/). This blog also shows you how to set up an R package manually.

Main: http://r-pkgs.had.co.nz/
Style guide
